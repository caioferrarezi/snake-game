(()=>{"use strict";var e={LEFT:[37,65],UP:[38,87],RIGHT:[39,68],DOWN:[40,83],ACTION:[13,32]};function t(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}const i=new(function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._screen,this._context}var i,n;return i=e,(n=[{key:"create",value:function(e,t){this._screen=document.querySelector("#screen"),this._screen.width=e,this._screen.height=t,this._context=this._screen.getContext("2d")}},{key:"getRandomPosition",value:function(){var e=Math.floor(Math.random()*this.width),t=Math.floor(Math.random()*this.height);return{x:e-e%10,y:t-t%10}}},{key:"width",get:function(){return this._screen.width}},{key:"height",get:function(){return this._screen.height}},{key:"context",get:function(){return this._context}}])&&t(i.prototype,n),e}());function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function e(t,i){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;n(this,e),this.x=t,this.y=i,this.next=s};function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._pos=i.getRandomPosition(),this._vel={x:0,y:0},this._size=10,this._color="#070600",this._init()}var t,n;return t=e,(n=[{key:"_init",value:function(){var e=this._pos,t=e.x,i=e.y;this._head=null,this._tail=null,this._push(t,i)}},{key:"_push",value:function(e,t){if(this._head){for(var i=this._head;null!==i.next;)i=i.next;i.next=new s(e,t)}else this._head=new s(e,t)}},{key:"_add",value:function(e,t){var i=this._head;this._head=new s(e,t,i)}},{key:"_pop",value:function(){for(var e=this._head,t=null;null!==e.next;)t=e,e=e.next;t.next=e.next}},{key:"moveLeft",value:function(){this._vel.x!==this._size&&(this._vel={x:-this._size,y:0})}},{key:"moveUp",value:function(){this._vel.y!==this._size&&(this._vel={x:0,y:-this._size})}},{key:"moveRight",value:function(){this._vel.x!==-this._size&&(this._vel={x:this._size,y:0})}},{key:"moveDown",value:function(){this._vel.y!==-this._size&&(this._vel={x:0,y:this._size})}},{key:"is",value:function(e,t){var i=this._head.next;if(!i)return!1;for(;null!==i.next;){if(i.x===e&&i.y===t)return!0;i=i.next}return!1}},{key:"collide",value:function(){var e=this._head,t=e.x,n=e.y;return t<0||t+this._size>i.width||n<0||n+this._size>i.height||this.is(t,n)}},{key:"eat",value:function(e,t){return this._head.x===e&&this._head.y===t}},{key:"grow",value:function(){for(var e=this._head;null!==e.next;)e=e.next;for(var t=0;t<5;t++)this._push(e.x,e.y)}},{key:"update",value:function(){this._pos.x+=this._vel.x,this._pos.y+=this._vel.y,this._add(this._pos.x,this._pos.y),this._pop()}},{key:"show",value:function(){for(var e=this._head;null!==e;)i.context.fillStyle=this._color,i.context.fillRect(e.x,e.y,this._size,this._size),e=e.next}}])&&o(t.prototype,n),e}();function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._size=10,this._color="#EA526F",this._pos=i.getRandomPosition()}var t,n;return t=e,(n=[{key:"update",value:function(){this._pos=i.getRandomPosition()}},{key:"show",value:function(){i.context.fillStyle=this._color,i.context.fillRect(this._pos.x,this._pos.y,this._size,this._size)}},{key:"x",get:function(){return this._pos.x}},{key:"y",get:function(){return this._pos.y}}])&&a(t.prototype,n),e}();function u(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=function(){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),i.create(400,400),this._init()}var n,s;return n=t,(s=[{key:"_init",value:function(){this._score=0,this._gameOver=!1,this._snake=new r,this._fruit=new h,this._setControls(),this._updateScore()}},{key:"_setControls",value:function(){window.onkeydown=this._onKeyDown.bind(this)}},{key:"_clear",value:function(){i.context.fillStyle="#F7F7FF",i.context.fillRect(0,0,i.width,i.height)}},{key:"_onKeyDown",value:function(t){var i=t.keyCode;if(t.preventDefault,e.LEFT.includes(i))return this._snake.moveLeft();if(e.UP.includes(i))return this._snake.moveUp();if(e.RIGHT.includes(i))return this._snake.moveRight();if(e.DOWN.includes(i))return this._snake.moveDown();if(e.ACTION.includes(i)){if(!1===this._gameOver)return;this._init()}}},{key:"_updateScore",value:function(){var e=this._score;document.dispatchEvent(new CustomEvent("score",{detail:{score:e}}))}},{key:"update",value:function(){if(!this._gameOver&&(this._snake.update(),this._snake.collide()&&(this._gameOver=!0),this._snake.eat(this._fruit.x,this._fruit.y))){for(this._snake.grow(),this._fruit.update();this._snake.is(this._fruit.x,this._fruit.y);)this._fruit.update();this._score++,this._updateScore()}}},{key:"show",value:function(){this._gameOver||(this._clear(),this._snake.show(),this._fruit.show())}}])&&u(n.prototype,s),t}(),l=document.querySelector("#score");document.addEventListener("score",(function(e){var t=e.detail;l.innerText="Score: ".concat(t.score)}));var _=new c(screen),f=Date.now(),v=Date.now();!function e(){(v=Date.now())-f>100&&(f=v,_.update(),_.show()),requestAnimationFrame(e)}()})();